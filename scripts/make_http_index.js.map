{"version":3,"file":"make_http_index.js","sourceRoot":"","sources":["../../scripts/make_http_index.ts"],"names":[],"mappings":";;AACA,uBAAyB;AACzB,2BAA6B;AAE7B,IAAM,QAAQ,GAA8C,EAAE,CAAC;AAC/D,IAAM,WAAW,GAAG,CAAC,MAAM,EAAE,cAAc,EAAE,kBAAkB,EAAE,OAAO,CAAC,CAAC;AAI1E,SAAS,MAAM,CAAC,KAAa,EAAE,IAAc,EAAE,IAAY;IACzD,IAAM,KAAK,GAAG,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;IACpC,KAAK,CAAC,OAAO,CAAC,UAAC,IAAI;QACjB,2CAA2C;QAC3C,IAAI,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;YACvD,OAAO;SACR;QACD,IAAM,KAAK,GAAM,KAAK,SAAI,IAAM,CAAC;QACjC,IAAI;YACF,wBAAwB;YACxB,IAAM,KAAK,GAAG,EAAE,CAAC,SAAS,CAAC,KAAK,CAAC,CAAA;YACjC,IAAI,KAAK,CAAC,cAAc,EAAE,EAAE;gBAC1B,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE;oBACxB,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;iBAC1B;gBACD,iCAAiC;gBACjC,IAAI,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE;oBAClC,OAAO;iBACR;gBACD,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;aACvC;YACD,IAAM,KAAK,GAAG,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;YACjC,IAAI,KAAK,CAAC,WAAW,EAAE,EAAE;gBACvB,IAAM,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,CAAA;gBAC7B,MAAM,CAAC,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,CAAA;aAC3B;iBAAM;gBACL,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAA;aAClB;SACF;QAAC,OAAO,CAAC,EAAE;YACV,sBAAsB;SACvB;IACH,CAAC,CAAC,CAAC;IACH,OAAO,IAAI,CAAA;AACb,CAAC;AAED,IAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC;AACjE,IAAI,OAAO,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;IAC7B,IAAM,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAC9B,IAAI,QAAM,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IACjC,OAAO,CAAC,EAAE,CAAC,UAAU,CAAC,QAAM,CAAC,EAAE;QAC7B,EAAE,CAAC,SAAS,CAAC,QAAM,CAAC,CAAC;QACrB,QAAM,GAAG,IAAI,CAAC,OAAO,CAAC,QAAM,CAAC,CAAC;KAC/B;IACD,EAAE,CAAC,aAAa,CAAC,KAAK,EAAE,SAAS,EAAE,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,CAAC;CAC1D;KAAM;IACL,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;CACxB","sourcesContent":["#! /usr/bin/env node\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nconst symLinks: {[dev: number]: {[ino: number]: boolean}} = {};\nconst ignoreFiles = ['.git', 'node_modules', 'bower_components', 'build'];\n\ntype FileTree = {[name: string]: FileTree | null};\n\nfunction rdSync(dpath: string, tree: FileTree, name: string): FileTree {\n  const files = fs.readdirSync(dpath);\n  files.forEach((file) => {\n    // ignore non-essential directories / files\n    if (ignoreFiles.indexOf(file) !== -1 || file[0] === '.') {\n      return;\n    }\n    const fpath = `${dpath}/${file}`;\n    try {\n      // Avoid infinite loops.\n      const lstat = fs.lstatSync(fpath)\n      if (lstat.isSymbolicLink()) {\n        if (!symLinks[lstat.dev]) {\n          symLinks[lstat.dev] = {};\n        }\n        // Ignore if we've seen it before\n        if (symLinks[lstat.dev][lstat.ino]) {\n          return;\n        }\n        symLinks[lstat.dev][lstat.ino] = true;\n      }\n      const fstat = fs.statSync(fpath);\n      if (fstat.isDirectory()) {\n        const child = tree[file] = {}\n        rdSync(fpath, child, file)\n      } else {\n        tree[file] = null\n      }\n    } catch (e) {\n      // Ignore and move on.\n    }\n  });\n  return tree\n}\n\nconst fsListing = JSON.stringify(rdSync(process.cwd(), {}, '/'));\nif (process.argv.length === 3) {\n  const fname = process.argv[2];\n  let parent = path.dirname(fname);\n  while (!fs.existsSync(parent)) {\n    fs.mkdirSync(parent);\n    parent = path.dirname(parent);\n  }\n  fs.writeFileSync(fname, fsListing, { encoding: 'utf8' });\n} else {\n  console.log(fsListing);\n}\n"]}